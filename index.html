<script>// Lock screen orientation to portrait
    function lockOrientation() {
        if (screen.orientation && screen.orientation.lock) {
            screen.orientation
                .lock("portrait")
                .then(() => console.log("Screen orientation locked to portrait"))
                .catch((err) => console.warn("Failed to lock screen orientation:", err));
        } else {
            console.warn("Screen orientation lock is not supported on this device.");
        }
    }

    // Handle device motion and orientation with fallback
    let unityInstance;
    let isMotionSupported = false; // Flag to check if motion is supported
    let motionDataAvailable = false; // Check if valid motion data is received

    function onUnityLoaded(instance) {
        unityInstance = instance;
        initializeMotionListeners();
    }

    function initializeMotionListeners() {
        if (window.DeviceOrientationEvent) {
            // Check if browser supports requesting permissions for motion
            if (typeof DeviceOrientationEvent.requestPermission === "function") {
                // For iOS 13+ where permissions must be requested explicitly
                DeviceOrientationEvent.requestPermission()
                    .then((response) => {
                        if (response === "granted") {
                            addMotionListeners();
                        } else {
                            console.warn("Motion access denied by user.");
                        }
                    })
                    .catch((err) => console.error("Error requesting motion permission:", err));
            } else {
                // For browsers that don't require explicit permission
                addMotionListeners();
            }
        } else {
            console.warn("Device motion is not supported on this device.");
        }
    }

    function addMotionListeners() {
        isMotionSupported = true;
        window.addEventListener(
            "deviceorientation",
            (event) => {
                if (unityInstance) {
                    // Send orientation data to Unity
                    if (event.beta !== null && event.gamma !== null) {
                        motionDataAvailable = true; // Motion data is successfully received
                        unityInstance.SendMessage(
                            "GyroManager",
                            "OnDeviceOrientation",
                            JSON.stringify({
                                alpha: event.alpha || 0, // Rotation around the z-axis
                                beta: event.beta || 0,  // Rotation around the x-axis
                                gamma: event.gamma || 0 // Rotation around the y-axis
                            })
                        );
                    }
                }
            },
            true
        );

        console.log("Motion listeners added.");
    }

    // Lock orientation and initialize motion listeners on page load
    window.addEventListener("load", () => {
        lockOrientation();

        // Fallback: Notify Unity to keep the camera static if motion is unsupported
        setTimeout(() => {
            if (!isMotionSupported || !motionDataAvailable) {
                console.log("Motion support unavailable. Keeping the camera static.");
                if (unityInstance) {
                    unityInstance.SendMessage("GyroManager", "DisableParallax");
                }
            }
        }, 3000); // Wait 3 seconds before assuming motion is unavailable
    });</script>
